(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{14:function(e,t,n){},15:function(e,t,n){},19:function(e,t,n){},20:function(e,t,n){"use strict";n.r(t);var r=n(0),i=n.n(r),a=n(7),o=n.n(a),s=(n(14),n(15),n(3)),l=n(2),u=n(5),c=n(4),d=function(){return Math.random().toString(16).substring(2,10)},f=function(){return d()+d()};function m(e){return"Program"===e.type}function E(e){return"Assignment"===e.type}function p(e){return"Identifier"===e.type}function h(e){return function(e){return"UndefinedExpression"===e.type}(e)||function(e){return"IntegerLiteral"===e.type}(e)||g(e)}function g(e){return"ArrayLiteral"===e.type}var y={Program:{fields:{assignments:{type:"nodes",nodeType:"Assignment"}}},Assignment:{fields:{uid:{type:"uid"},identifier:{type:"node",nodeType:"Identifier"},expression:{type:"node",nodeType:"Expression"}}},Identifier:{fields:{name:{type:"value"}}},UndefinedExpression:{fields:{}},IntegerLiteral:{fields:{value:{type:"value"}}},ArrayLiteral:{fields:{items:{type:"nodes",nodeType:"Expression"}}}},v={Expression:["UndefinedExpression","IntegerLiteral"]};function w(e,t){var n=e,r=!0,i=!1,a=void 0;try{for(var o,s=t[Symbol.iterator]();!(r=(o=s.next()).done);r=!0){n=n[o.value]}}catch(l){i=!0,a=l}finally{try{r||null==s.return||s.return()}finally{if(i)throw a}}return n}function b(e,t,n){var r=t,i=0,a=!0,o=!1,s=void 0;try{for(var l,u=n[Symbol.iterator]();!(a=(l=u.next()).done);a=!0){var c=l.value;if(e===r)return[n.slice(0,i),n.slice(i)];r=r[c],i++}}catch(d){o=!0,s=d}finally{try{a||null==u.return||u.return()}finally{if(o)throw s}}if(e===r)return[n.slice(0,i),n.slice(i)];throw new Error("node was not in path")}var x=function(e,t){return JSON.stringify(e)===JSON.stringify(t)};function O(e,t){if("number"!==typeof t)throw new Error;var n=Object(c.a)({},e,{assignments:[].concat(Object(s.a)(e.assignments.slice(0,t)),Object(s.a)(e.assignments.slice(t+1)))});if(n.assignments.length){var r=t-1;return r=Math.max(r,0),[n,["assignments",r=Math.min(r,e.assignments.length-1)],null]}return n.assignments.push({type:"Assignment",uid:f(),identifier:{type:"Identifier",name:null},expression:{type:"UndefinedExpression"}}),[n,["assignments",0,"identifier"],{text:""}]}function I(e,t){return Object(c.a)({},e,{name:t||null})}function T(e,t){return"["===t?{type:"ArrayLiteral",items:[]}:/^[-+]?(?:\d*\.?\d+|\d+\.?\d*)(?:[eE][-+]?\d+)?$/.test(t)?{type:"IntegerLiteral",value:Number(t)}:{type:"UndefinedExpression"}}var j=[["Assignment",["MOVE_LEFT"],function(e){var t=e.node,n=e.subpath;if(!e.textEdit)return x(n,["expression"])?[t,["identifier"],null]:x(n,["identifier"])?[t,[],null]:void 0}],["Assignment",["MOVE_RIGHT"],function(e){var t=e.node,n=e.subpath;if(!e.textEdit)return x(n,["identifier"])?[t,["expression"],null]:x(n,[])?[t,["identifier"],null]:void 0}],["Assignment",["ZOOM_IN"],function(e){var t=e.node,n=e.subpath;if(!e.textEdit)return x(n,[])?[t,["identifier"],null]:void 0}],["Assignment",["ZOOM_OUT"],function(e){var t=e.node,n=e.subpath;if(!e.textEdit)return x(n,["identifier"])||x(n,["expression"])?[t,[],null]:void 0}],["Program",["MOVE_UP","MOVE_DOWN"],function(e){var t=e.node,n=e.subpath,r=e.textEdit,i=e.action;if(!m(t))throw new Error;if(!r){var a=function(){var e=n[1];if("number"!==typeof e)throw new Error;var r=e+("MOVE_UP"===i.type?-1:1);return r=Math.max(r,0),r=Math.min(r,t.assignments.length-1)};return 2===n.length&&"assignments"===n[0]?[t,["assignments",a()],null]:3===n.length&&"assignments"===n[0]?[t,["assignments",a(),n[2]],null]:void 0}}],["Program",["DELETE"],function(e){var t=e.node,n=e.subpath,r=e.textEdit;if(!m(t))throw new Error;if(2===n.length&&"assignments"===n[0]){if(r)throw new Error;var i=n[1];if("number"!==typeof i)throw new Error;return O(t,i)}}],["Identifier",["ENTER"],function(e){var t=e.node,n=e.subpath,r=e.textEdit;if(!p(t))throw new Error;if(r)return[t,n,null];var i=t.name||"";return[I(t,i),n,{text:i}]}],["Expression",["ENTER"],function(e){var t,n=e.node,r=e.subpath;if(e.textEdit)return[n,r,null];switch(n.type){case"IntegerLiteral":t=n.value.toString();break;case"UndefinedExpression":t="";break;default:throw new Error}return[T(0,t),r,{text:t}]}],["Program",["INSERT_AFTER"],function(e){var t=e.node,n=e.subpath;e.textEdit;if(!m(t))throw new Error;if(n.length>=2&&"assignments"===n[0]){var r=n[1];if("number"!==typeof r)throw new Error;return[Object(c.a)({},t,{assignments:[].concat(Object(s.a)(t.assignments.slice(0,r+1)),[{type:"Assignment",uid:f(),identifier:{type:"Identifier",name:null},expression:{type:"UndefinedExpression"}}],Object(s.a)(t.assignments.slice(r+1)))}),["assignments",r+1,"identifier"],{text:""}]}}],["Program",["DELETE"],function(e){var t=e.node,n=e.subpath,r=e.textEdit;if(!m(t))throw new Error;if(3===n.length&&"assignments"===n[0]&&"identifier"===n[2]&&r&&""===r.text){var i=n[1];if("number"!==typeof i)throw new Error;if("UndefinedExpression"===t.assignments[i].expression.type){if("number"!==typeof i)throw new Error;return O(t,i)}}}],["Identifier",["CHAR"],function(e){var t=e.node,n=e.subpath,r=e.textEdit,i=e.action;if(!p(t))throw new Error;if(r||n.length||!i.char)throw new Error;if(" "!==i.char)return[I(t,i.char),n,{text:i.char}]}],["Expression",["CHAR"],function(e){var t=e.node,n=e.subpath,r=e.textEdit,i=e.action;if(!h(t))throw new Error;if(r||n.length||!i.char)throw new Error;if(" "!==i.char)return[T(0,i.char),n,{text:i.char}]}],["Assignment",["ASSIGN"],function(e){var t=e.node,n=e.subpath,r=e.textEdit;if(!E(t))throw new Error;if(!r&&(x(n,[])||x(n,["identifier"])||x(n,["expression"]))||r&&x(n,["identifier"]))return[Object(c.a)({},t,{expression:T(t.expression,"")}),["expression"],{text:""}]}],["Identifier",["SET_TEXT"],function(e){var t=e.node,n=e.subpath,r=e.textEdit,i=e.action;if(!r)throw new Error;if("string"!==typeof i.text)throw new Error;if(0!==n.length)throw new Error;if(!p(t))throw new Error;return[I(t,i.text),n,{text:i.text}]}],["Expression",["SET_TEXT"],function(e){var t=e.node,n=e.subpath,r=e.textEdit,i=e.action;if(!r)throw new Error;if("string"!==typeof i.text)throw new Error;if(!h(t))throw new Error;return[T(0,i.text),n,{text:i.text}]}],["ArrayLiteral",["ZOOM_OUT","MOVE_LEFT"],function(e){var t=e.node,n=e.subpath;if(!e.textEdit&&2===n.length){if("items"!==n[0]||"number"!==typeof n[1])throw Error();return[t,[],null]}}],["ArrayLiteral",["ZOOM_IN","MOVE_RIGHT"],function(e){var t=e.node,n=e.subpath;if(!e.textEdit)return 0===n.length?[t,["items",0],null]:void 0}],["ArrayLiteral",["MOVE_UP","MOVE_DOWN"],function(e){var t=e.node,n=e.subpath,r=e.textEdit,i=e.action;if(!g(t))throw new Error;if(!r&&2===n.length&&"items"===n[0]){var a=n[1];if("number"!==typeof a)throw new Error;var o=a+("MOVE_UP"===i.type?-1:1);return o<0||o>=t.items.length?[t,[],null]:[t,["items",o],null]}}],["ArrayLiteral",["INSERT_AFTER"],function(e){var t=e.node,n=e.subpath;e.textEdit;if(!g(t))throw new Error;if(2===n.length&&"items"===n[0]){var r=n[1];if("number"!==typeof r)throw new Error;return[Object(c.a)({},t,{items:[].concat(Object(s.a)(t.items.slice(0,r+1)),[{type:"UndefinedExpression"}],Object(s.a)(t.items.slice(r+1)))}),["items",r+1],{text:""}]}}]];function A(e,t,n){if(!function(e,t,n){if(e===t)return!0;var r=t,i=!0,a=!1,o=void 0;try{for(var s,l=n[Symbol.iterator]();!(i=(s=l.next()).done);i=!0)if(e===(r=r[s.value]))return!0}catch(u){a=!0,o=u}finally{try{i||null==l.return||l.return()}finally{if(a)throw o}}return!1}(t,e.root,e.selectionPath))return null;var r=y[t.type];if(!r)throw new Error;for(var i={type:t.type},a=null,o=null,s=!1,u=t,c=0,d=Object.entries(r.fields);c<d.length;c++){var f=d[c],g=Object(l.a)(f,2),w=g[0];switch(g[1].type){case"node":var x=u[w],O=A(e,x,n);if(O){if(s)throw new Error("already handled");var I=Object(l.a)(O,3),T=I[0],L=I[1],N=I[2];i[w]=T,a=L,o=N,s=!0}else i[w]=x;break;case"nodes":var k=[],M=u[w],_=!0,S=!1,P=void 0;try{for(var R,U=M[Symbol.iterator]();!(_=(R=U.next()).done);_=!0){var C=R.value,V=A(e,C,n);if(V){if(s)throw new Error("already handled");var D=Object(l.a)(V,3),H=D[0],F=D[1],W=D[2];k.push(H),a=F,o=W,s=!0}else k.push(C)}}catch(ie){S=!0,P=ie}finally{try{_||null==U.return||U.return()}finally{if(S)throw P}}i[w]=k;break;case"value":case"uid":i[w]=u[w];break;default:throw new Error}}if(s){if(!function(e){return m(e)||E(e)||p(e)||h(e)}(i))throw new Error;if(!a)throw new Error;return[i,a,o]}for(var Z=0,G=j;Z<G.length;Z++){var K=G[Z],J=Object(l.a)(K,3),z=J[0],X=J[1],B=J[2];if((v[z]?v[z]:[z]).includes(t.type)&&X.includes(n.type)){var $=b(t,e.root,e.selectionPath),q=Object(l.a)($,2),Q=q[0],Y=B({node:t,subpath:q[1],action:n,textEdit:e.textEdit});if(Y){console.log("handlerResult",Y);var ee=Object(l.a)(Y,3),te=ee[0],ne=ee[1],re=ee[2];return[te,Q.concat(ne),re]}}}return null}function L(e,t){console.log("action",t.type);var n=A(e,e.root,t);if(n){console.log("handled");var r=Object(l.a)(n,3),i=r[0],a=r[1],o=r[2];if(console.log("new selectionPath is",a,"textEdit is",o),!m(i))throw new Error;return{root:i,selectionPath:a,textEdit:o}}return console.log("not handled"),e}var N={root:{type:"Program",assignments:[{type:"Assignment",uid:f(),identifier:{type:"Identifier",name:"foo"},expression:{type:"IntegerLiteral",value:123}},{type:"Assignment",uid:f(),identifier:{type:"Identifier",name:"bar"},expression:{type:"IntegerLiteral",value:456}},{type:"Assignment",uid:f(),identifier:{type:"Identifier",name:"baz"},expression:{type:"IntegerLiteral",value:789}},{type:"Assignment",uid:f(),identifier:{type:"Identifier",name:null},expression:{type:"IntegerLiteral",value:4321}},{type:"Assignment",uid:f(),identifier:{type:"Identifier",name:"blap"},expression:{type:"ArrayLiteral",items:[{type:"IntegerLiteral",value:123},{type:"ArrayLiteral",items:[{type:"IntegerLiteral",value:345},{type:"IntegerLiteral",value:456}]},{type:"IntegerLiteral",value:234}]}},{type:"Assignment",uid:f(),identifier:{type:"Identifier",name:"quux"},expression:{type:"UndefinedExpression"}}]},selectionPath:["assignments",0,"identifier"],textEdit:null},k=(n(19),{MOVE_UP:"up",MOVE_DOWN:"down",MOVE_LEFT:"left",MOVE_RIGHT:"right",ZOOM_IN:"shift+right",ZOOM_OUT:"shift+left",ENTER:"enter",INSERT_AFTER:[";",","],DELETE:"backspace",ASSIGN:"="}),M=["=",";",","],_=Object(r.createContext)(),S=Object(r.createContext)();function P(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";return e===Object(r.useContext)(S)?t+" Editor-selected":t}var R=Object(r.createContext)();function U(){var e=Object(r.useContext)(_),t=Object(r.useContext)(R);return i.a.createElement("div",null,i.a.createElement("input",{className:"Editor-text-edit-input Editor-selected",value:t.text,onChange:function(t){e({type:"SET_TEXT",text:t.target.value})},autoFocus:!0}))}function C(){return i.a.createElement("div",{className:"Editor-hole"},"\xa0")}function V(e){var t=e.program;return i.a.createElement("div",{className:"Editor-program"},t.assignments.map(function(e){return i.a.createElement(D,{assignment:e,key:e.uid})}))}function D(e){var t=e.assignment;return i.a.createElement("div",{className:P(t,"Editor-assignment")},i.a.createElement(F,{identifier:t.identifier}),i.a.createElement("div",null,"\xa0=\xa0"),i.a.createElement(J,{expression:t.expression}))}function H(e){var t=e.identifier;return i.a.createElement("div",{className:P(t)},"string"===typeof t.name?t.name:i.a.createElement(C,null))}function F(e){var t=e.identifier,n=t===Object(r.useContext)(S),a=Object(r.useContext)(R);return n&&a?i.a.createElement(U,null):i.a.createElement(H,{identifier:t})}function W(e){var t=e.integerLiteral;return i.a.createElement("div",{className:P(t)},t.value)}function Z(e){var t=e.arrayLiteral;return i.a.createElement("div",{className:P(t)},i.a.createElement("div",null,"["),i.a.createElement("div",{className:"Editor-array-items"},t.items.map(function(e){return i.a.createElement("div",{className:"Editor-array-item"},i.a.createElement(J,{expression:e}))})),i.a.createElement("div",null,"]"))}function G(e){var t=e.undefinedExpression;return i.a.createElement("div",{className:P(t)},i.a.createElement(C,null))}function K(e){var t=e.expression;switch(t.type){case"IntegerLiteral":return i.a.createElement(W,{integerLiteral:t});case"ArrayLiteral":return i.a.createElement(Z,{arrayLiteral:t});case"UndefinedExpression":return i.a.createElement(G,{undefinedExpression:t});default:throw new Error}}function J(e){var t=e.expression,n=t===Object(r.useContext)(S),a=Object(r.useContext)(R);return n&&a?i.a.createElement(U,null):i.a.createElement(K,{expression:t})}function z(e){var t=e.autoFocus,n=Object(r.useReducer)(L,N),a=Object(l.a)(n,2),o=a[0],c=a[1],d=Object(r.useRef)(),f=Object(r.useState)(t),m=Object(l.a)(f,1)[0];Object(r.useEffect)(function(){m&&d.current.focus()},[m]);var E=Object(r.useRef)(!1);Object(r.useEffect)(function(){var e=!!o.textEdit;E.current&&!e&&d.current.focus(),E.current=e});for(var p={},h=function(){var e=y[g];p[e]=function(t){("input"!==t.target.tagName.toLowerCase()||M.includes(t.key))&&t.preventDefault(),c({type:e})}},g=0,y=Object.keys(k);g<y.length;g++)h();return i.a.createElement(u.HotKeys,{keyMap:k,handlers:p},i.a.createElement(u.ObserveKeys,null,i.a.createElement("div",{className:"Editor",onKeyDown:function(e){"input"!==e.target.tagName.toLowerCase()&&(1!==Object(s.a)(e.key).length||e.altkey||e.ctrlKey||e.metaKey||M.includes(e.key)||(e.preventDefault(),c({type:"CHAR",char:e.key})))},tabIndex:"0",ref:d},i.a.createElement(_.Provider,{value:c},i.a.createElement(S.Provider,{value:w(o.root,o.selectionPath)},i.a.createElement(R.Provider,{value:o.textEdit},i.a.createElement(V,{program:o.root})))))))}var X=function(){return i.a.createElement("div",{className:"App"},i.a.createElement(z,{autoFocus:!0}),i.a.createElement("div",null,i.a.createElement("h2",null,"Notes"),i.a.createElement("ul",null,i.a.createElement("li",null,i.a.createElement("strong",null,"The goal of this is to explore if there's a good way to do keyboard-driven structured code editing that doesn't suck. To not suck, I believe that there must be a very small number of keyboard commands, and they should be rather intuitive/obvious. As a bonus, it would be nice if it behaved similarly to spreadsheets or normal programming editors.")),i.a.createElement("li",null,"Warning: A bunch of shit only half-works."),i.a.createElement("li",null,"If you don't see a green selection/cursor box, focus the editor."),i.a.createElement("li",null,"There's no mouse/touch support yet, only keyboard."),i.a.createElement("li",null,'The AST always stays "well-formed", but some bits are allowed to be temporarily unspecified or invalid. The program may still be able to run with unspecified values, and it will be very clear to the user (red boxes) what is invalid/missing.'),i.a.createElement("li",null,"This code doesn't yet \"run\", it's just a fake language for now."),i.a.createElement("li",null,"Up/down arrows move up and down between assignments and array items."),i.a.createElement("li",null,'Shift-left (or just left, if unambiguous) "zooms out" selection and shift-right (Or just right, if unambiguous) "zooms in" selection (into nested structures).'),i.a.createElement("li",null,'If LHS of an assignment is selected, left arrow moves "out" to select the entire assignment.'),i.a.createElement("li",null,"Pressing enter on an identifier or number will begin editing it. Pressing enter again will stop editing."),i.a.createElement("li",null,"Instead of pressing enter, you can just start typing letters/numbers and it will begin the edit (overwriting what it there)."),i.a.createElement("li",null,'Pressing the = key on the "top levels" of an assignment will beging editing the RHS.'),i.a.createElement("li",null,"A red box indicates an undefined identifer or expression."),i.a.createElement("li",null,"If you enter an invalid number as an expression, it will ignore it and leave an undefined box."),i.a.createElement("li",null,"Semicolon or comma (interchangeable) will both add a new assignment or array item below the current one (even during a text edit)."),i.a.createElement("li",null,"When an entire assignment is selected, delete will delete it."),i.a.createElement("li",null,i.a.createElement("strong",null,"TODO")," Allow creating array literals."),i.a.createElement("li",null,i.a.createElement("strong",null,"TODO")," Allow deleting array items."),i.a.createElement("li",null,i.a.createElement("strong",null,"TODO")," Validate LHS identifiers."),i.a.createElement("li",null,i.a.createElement("strong",null,"TODO")," Escape will revert any in-progress edit."))))};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));o.a.render(i.a.createElement(X,null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then(function(e){e.unregister()})},8:function(e,t,n){e.exports=n(20)}},[[8,1,2]]]);
//# sourceMappingURL=main.576d0e19.chunk.js.map