(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{14:function(e,t,r){},15:function(e,t,r){},19:function(e,t,r){},20:function(e,t,r){"use strict";r.r(t);var n=r(0),i=r.n(n),a=r(7),o=r.n(a),s=(r(14),r(15),r(3)),u=r(2),l=r(5),c=r(4),f=function(){return Math.random().toString(16).substring(2,10)},d=function(){return f()+f()};function E(e){return"Program"===e.type}function p(e){return"Assignment"===e.type}function m(e){return"Identifier"===e.type}function v(e){return function(e){return"UndefinedExpression"===e.type}(e)||function(e){return"IntegerLiteral"===e.type}(e)||y(e)}function y(e){return"ArrayLiteral"===e.type}var h={Program:{fields:{assignments:{type:"nodes",nodeType:"Assignment"}}},Assignment:{fields:{uid:{type:"uid"},identifier:{type:"node",nodeType:"Identifier"},expression:{type:"node",nodeType:"Expression"}}},Identifier:{fields:{name:{type:"value"}}},UndefinedExpression:{fields:{}},IntegerLiteral:{fields:{value:{type:"value"}}},ArrayLiteral:{fields:{items:{type:"nodes",nodeType:"Expression"}}}},g={Expression:["UndefinedExpression","IntegerLiteral"]};function x(e,t){var r=e,n=!0,i=!1,a=void 0;try{for(var o,s=t[Symbol.iterator]();!(n=(o=s.next()).done);n=!0){r=r[o.value]}}catch(u){i=!0,a=u}finally{try{n||null==s.return||s.return()}finally{if(i)throw a}}return r}function w(e,t,r){var n=t,i=0,a=!0,o=!1,s=void 0;try{for(var u,l=r[Symbol.iterator]();!(a=(u=l.next()).done);a=!0){var c=u.value;if(e===n)return[r.slice(0,i),r.slice(i)];n=n[c],i++}}catch(f){o=!0,s=f}finally{try{a||null==l.return||l.return()}finally{if(o)throw s}}if(e===n)return[r.slice(0,i),r.slice(i)];throw new Error("node was not in path")}var b=function(e,t){return JSON.stringify(e)===JSON.stringify(t)};function O(e,t){if("number"!==typeof t)throw new Error;var r=Object(c.a)({},e,{assignments:[].concat(Object(s.a)(e.assignments.slice(0,t)),Object(s.a)(e.assignments.slice(t+1)))});if(r.assignments.length){var n=t-1;return n=Math.max(n,0),[r,["assignments",n=Math.min(n,e.assignments.length-1)],null]}return r.assignments.push({type:"Assignment",uid:d(),identifier:{type:"Identifier",name:null},expression:{type:"UndefinedExpression"}}),[r,["assignments",0,"identifier"],{text:""}]}function j(e,t){return Object(c.a)({},e,{name:t||null})}function I(e,t){return"["===t?{type:"ArrayLiteral",items:[]}:/^[-+]?(?:\d*\.?\d+|\d+\.?\d*)(?:[eE][-+]?\d+)?$/.test(t)?{type:"IntegerLiteral",value:Number(t)}:{type:"UndefinedExpression"}}var A=[["Assignment",["MOVE_OUT"],function(e){var t=e.node,r=e.subpath;if(!e.textEdit)return b(r,["identifier"])?[t,[],null]:b(r,["expression"])?[t,["identifier"],null]:void 0}],["Assignment",["MOVE_IN"],function(e){var t=e.node,r=e.subpath;if(!e.textEdit)return b(r,[])?[t,["identifier"],null]:b(r,["identifier"])?[t,["expression"],null]:void 0}],["Program",["MOVE_PREV","MOVE_NEXT"],function(e){var t=e.node,r=e.subpath,n=e.textEdit,i=e.action;if(!E(t))throw new Error;if(!n){var a=function(){var e=r[1];if("number"!==typeof e)throw new Error;var n=e+("MOVE_PREV"===i.type?-1:1);return n=Math.max(n,0),n=Math.min(n,t.assignments.length-1)};return 2===r.length&&"assignments"===r[0]?[t,["assignments",a()],null]:3===r.length&&"assignments"===r[0]?[t,["assignments",a(),r[2]],null]:void 0}}],["Program",["DELETE"],function(e){var t=e.node,r=e.subpath,n=e.textEdit;if(!E(t))throw new Error;if(2===r.length&&"assignments"===r[0]){if(n)throw new Error;var i=r[1];if("number"!==typeof i)throw new Error;return O(t,i)}}],["Identifier",["ENTER"],function(e){var t=e.node,r=e.subpath,n=e.textEdit;if(!m(t))throw new Error;if(n)return[t,r,null];var i=t.name||"";return[j(t,i),r,{text:i}]}],["Expression",["ENTER"],function(e){var t,r=e.node,n=e.subpath;if(e.textEdit)return[r,n,null];switch(r.type){case"IntegerLiteral":t=r.value.toString();break;case"UndefinedExpression":t="";break;default:throw new Error}return[I(0,t),n,{text:t}]}],["Program",["INSERT_AFTER"],function(e){var t=e.node,r=e.subpath,n=e.textEdit;if(!E(t))throw new Error;if(r.length>=2&&"assignments"===r[0]&&!n){var i=r[1];if("number"!==typeof i)throw new Error;return[Object(c.a)({},t,{assignments:[].concat(Object(s.a)(t.assignments.slice(0,i+1)),[{type:"Assignment",uid:d(),identifier:{type:"Identifier",name:null},expression:{type:"UndefinedExpression"}}],Object(s.a)(t.assignments.slice(i+1)))}),["assignments",i+1,"identifier"],{text:""}]}}],["Program",["DELETE"],function(e){var t=e.node,r=e.subpath,n=e.textEdit;if(!E(t))throw new Error;if(3===r.length&&"assignments"===r[0]&&"identifier"===r[2]&&n&&""===n.text){var i=r[1];if("number"!==typeof i)throw new Error;if("UndefinedExpression"===t.assignments[i].expression.type){if("number"!==typeof i)throw new Error;return O(t,i)}}}],["Identifier",["CHAR"],function(e){var t=e.node,r=e.subpath,n=e.textEdit,i=e.action;if(!m(t))throw new Error;if(n||r.length||!i.char)throw new Error;if(" "!==i.char)return[j(t,i.char),r,{text:i.char}]}],["Expression",["CHAR"],function(e){var t=e.node,r=e.subpath,n=e.textEdit,i=e.action;if(!v(t))throw new Error;if(n||r.length||!i.char)throw new Error;if(" "!==i.char)return[I(0,i.char),r,{text:i.char}]}],["Assignment",["ASSIGN"],function(e){var t=e.node,r=e.subpath,n=e.textEdit;if(!p(t))throw new Error;if(!n&&(b(r,[])||b(r,["identifier"])||b(r,["expression"]))||n&&b(r,["identifier"]))return[Object(c.a)({},t,{expression:I(t.expression,"")}),["expression"],{text:""}]}],["Identifier",["SET_TEXT"],function(e){var t=e.node,r=e.subpath,n=e.textEdit,i=e.action;if(!n)throw new Error;if("string"!==typeof i.text)throw new Error;if(0!==r.length)throw new Error;if(!m(t))throw new Error;return[j(t,i.text),r,{text:i.text}]}],["Expression",["SET_TEXT"],function(e){var t=e.node,r=e.subpath,n=e.textEdit,i=e.action;if(!n)throw new Error;if("string"!==typeof i.text)throw new Error;if(!v(t))throw new Error;return[I(0,i.text),r,{text:i.text}]}],["ArrayLiteral",["MOVE_OUT"],function(e){var t=e.node,r=e.subpath;if(!e.textEdit&&2===r.length){if("items"!==r[0]||"number"!==typeof r[1])throw Error();return[t,[],null]}}],["ArrayLiteral",["MOVE_IN"],function(e){var t=e.node,r=e.subpath;if(!e.textEdit)return 0===r.length?[t,["items",0],null]:void 0}],["ArrayLiteral",["MOVE_PREV","MOVE_NEXT"],function(e){var t=e.node,r=e.subpath,n=e.textEdit,i=e.action;if(!y(t))throw new Error;if(!n&&2===r.length&&"items"===r[0]){var a=r[1];if("number"!==typeof a)throw new Error;var o=a+("MOVE_PREV"===i.type?-1:1);return o<0||o>=t.items.length?[t,[],null]:[t,["items",o],null]}}],["ArrayLiteral",["INSERT_AFTER"],function(e){var t=e.node,r=e.subpath,n=e.textEdit;if(!y(t))throw new Error;if(2===r.length&&"items"===r[0]&&!n){var i=r[1];if("number"!==typeof i)throw new Error;return[Object(c.a)({},t,{items:[].concat(Object(s.a)(t.items.slice(0,i+1)),[{type:"UndefinedExpression"}],Object(s.a)(t.items.slice(i+1)))}),["items",i+1],{text:""}]}}]];function L(e,t,r){if(!function(e,t,r){if(e===t)return!0;var n=t,i=!0,a=!1,o=void 0;try{for(var s,u=r[Symbol.iterator]();!(i=(s=u.next()).done);i=!0)if(e===(n=n[s.value]))return!0}catch(l){a=!0,o=l}finally{try{i||null==u.return||u.return()}finally{if(a)throw o}}return!1}(t,e.root,e.selectionPath))return null;var n=h[t.type];if(!n)throw new Error;for(var i={type:t.type},a=null,o=null,s=!1,l=t,c=0,f=Object.entries(n.fields);c<f.length;c++){var d=f[c],y=Object(u.a)(d,2),x=y[0];switch(y[1].type){case"node":var b=l[x],O=L(e,b,r);if(O){if(s)throw new Error("already handled");var j=Object(u.a)(O,3),I=j[0],T=j[1],N=j[2];i[x]=I,a=T,o=N,s=!0}else i[x]=b;break;case"nodes":var P=[],R=l[x],M=!0,_=!1,S=void 0;try{for(var V,k=R[Symbol.iterator]();!(M=(V=k.next()).done);M=!0){var C=V.value,U=L(e,C,r);if(U){if(s)throw new Error("already handled");var D=Object(u.a)(U,3),F=D[0],X=D[1],K=D[2];P.push(F),a=X,o=K,s=!0}else P.push(C)}}catch(ie){_=!0,S=ie}finally{try{M||null==k.return||k.return()}finally{if(_)throw S}}i[x]=P;break;case"value":case"uid":i[x]=l[x];break;default:throw new Error}}if(s){if(!function(e){return E(e)||p(e)||m(e)||v(e)}(i))throw new Error;if(!a)throw new Error;return[i,a,o]}for(var H=0,J=A;H<J.length;H++){var B=J[H],G=Object(u.a)(B,3),W=G[0],$=G[1],q=G[2];if((g[W]?g[W]:[W]).includes(t.type)&&$.includes(r.type)){var z=w(t,e.root,e.selectionPath),Q=Object(u.a)(z,2),Y=Q[0],Z=q({node:t,subpath:Q[1],action:r,textEdit:e.textEdit});if(Z){console.log("handlerResult",Z);var ee=Object(u.a)(Z,3),te=ee[0],re=ee[1],ne=ee[2];return[te,Y.concat(re),ne]}}}return null}function T(e,t){console.log("action",t.type);var r=L(e,e.root,t);if(r){console.log("handled");var n=Object(u.a)(r,3),i=n[0],a=n[1],o=n[2];if(console.log("new selectionPath is",a,"textEdit is",o),!E(i))throw new Error;return{root:i,selectionPath:a,textEdit:o}}return console.log("not handled"),e}var N={root:{type:"Program",assignments:[{type:"Assignment",uid:d(),identifier:{type:"Identifier",name:"foo"},expression:{type:"IntegerLiteral",value:123}},{type:"Assignment",uid:d(),identifier:{type:"Identifier",name:"bar"},expression:{type:"IntegerLiteral",value:456}},{type:"Assignment",uid:d(),identifier:{type:"Identifier",name:"baz"},expression:{type:"IntegerLiteral",value:789}},{type:"Assignment",uid:d(),identifier:{type:"Identifier",name:null},expression:{type:"IntegerLiteral",value:4321}},{type:"Assignment",uid:d(),identifier:{type:"Identifier",name:"blap"},expression:{type:"ArrayLiteral",items:[{type:"IntegerLiteral",value:123},{type:"ArrayLiteral",items:[{type:"IntegerLiteral",value:345},{type:"IntegerLiteral",value:456}]},{type:"IntegerLiteral",value:234}]}},{type:"Assignment",uid:d(),identifier:{type:"Identifier",name:"quux"},expression:{type:"UndefinedExpression"}}]},selectionPath:["assignments",0,"identifier"],textEdit:null},P=(r(19),{MOVE_PREV:"up",MOVE_NEXT:"down",MOVE_OUT:"left",MOVE_IN:"right",ENTER:"enter",INSERT_AFTER:"shift+enter",DELETE:"backspace",ASSIGN:"="}),R=["="],M=Object(n.createContext)(),_=Object(n.createContext)();function S(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";return e===Object(n.useContext)(_)?t+" Editor-selected":t}var V=Object(n.createContext)();function k(){var e=Object(n.useContext)(M),t=Object(n.useContext)(V);return i.a.createElement("div",null,i.a.createElement("input",{className:"Editor-text-edit-input Editor-selected",value:t.text,onChange:function(t){e({type:"SET_TEXT",text:t.target.value})},autoFocus:!0}))}function C(){return i.a.createElement("div",{className:"Editor-hole"},"\xa0")}function U(e){var t=e.program;return i.a.createElement("div",null,t.assignments.map(function(e){return i.a.createElement(D,{assignment:e,key:e.uid})}))}function D(e){var t=e.assignment;return i.a.createElement("div",{className:S(t,"Editor-assignment")},i.a.createElement(X,{identifier:t.identifier}),i.a.createElement("div",null,"\xa0=\xa0"),i.a.createElement(G,{expression:t.expression}))}function F(e){var t=e.identifier;return i.a.createElement("div",{className:S(t)},"string"===typeof t.name?t.name:i.a.createElement(C,null))}function X(e){var t=e.identifier,r=t===Object(n.useContext)(_),a=Object(n.useContext)(V);return r&&a?i.a.createElement(k,null):i.a.createElement(F,{identifier:t})}function K(e){var t=e.integerLiteral;return i.a.createElement("div",{className:S(t)},t.value)}function H(e){var t=e.arrayLiteral;return i.a.createElement("div",{className:S(t)},i.a.createElement("div",null,"["),i.a.createElement("div",{className:"Editor-array-items"},t.items.map(function(e){return i.a.createElement("div",{className:"Editor-array-item"},i.a.createElement(G,{expression:e}))})),i.a.createElement("div",null,"]"))}function J(e){var t=e.undefinedExpression;return i.a.createElement("div",{className:S(t)},i.a.createElement(C,null))}function B(e){var t=e.expression;switch(t.type){case"IntegerLiteral":return i.a.createElement(K,{integerLiteral:t});case"ArrayLiteral":return i.a.createElement(H,{arrayLiteral:t});case"UndefinedExpression":return i.a.createElement(J,{undefinedExpression:t});default:throw new Error}}function G(e){var t=e.expression,r=t===Object(n.useContext)(_),a=Object(n.useContext)(V);return r&&a?i.a.createElement(k,null):i.a.createElement(B,{expression:t})}function W(e){var t=e.autoFocus,r=Object(n.useReducer)(T,N),a=Object(u.a)(r,2),o=a[0],c=a[1],f=Object(n.useRef)(),d=Object(n.useState)(t),E=Object(u.a)(d,1)[0];Object(n.useEffect)(function(){E&&f.current.focus()},[E]);var p=Object(n.useRef)(!1);Object(n.useEffect)(function(){var e=!!o.textEdit;p.current&&!e&&f.current.focus(),p.current=e});for(var m={},v=function(){var e=h[y];m[e]=function(t){R.includes(t.key)&&t.preventDefault(),c({type:e})}},y=0,h=Object.keys(P);y<h.length;y++)v();return i.a.createElement(l.HotKeys,{keyMap:P,handlers:m},i.a.createElement(l.ObserveKeys,null,i.a.createElement("div",{className:"Editor",onKeyDown:function(e){"input"!==e.target.tagName.toLowerCase()&&(1!==Object(s.a)(e.key).length||e.altkey||e.ctrlKey||e.metaKey||R.includes(e.key)||(e.preventDefault(),c({type:"CHAR",char:e.key})))},tabIndex:"0",ref:f},i.a.createElement(M.Provider,{value:c},i.a.createElement(_.Provider,{value:x(o.root,o.selectionPath)},i.a.createElement(V.Provider,{value:o.textEdit},i.a.createElement(U,{program:o.root})))))))}var $=function(){return i.a.createElement("div",{className:"App"},i.a.createElement(W,{autoFocus:!0}))};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));o.a.render(i.a.createElement($,null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then(function(e){e.unregister()})},8:function(e,t,r){e.exports=r(20)}},[[8,1,2]]]);
//# sourceMappingURL=main.7f821eee.chunk.js.map